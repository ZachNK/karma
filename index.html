<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Know Your Karma</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <h1>Know Your Karma</h1>
    <h2>
        <div>
            <input type="radio" id="Choice1" name="sex" value="male" checked>
            <label for="Choice1">Male</label>
            <input type="radio" id="Choice2" name="sex" value="female">
            <label for="Choice2">Female</label>
        </div>
        <input type="datetime-local" id="msg">
        <!-- <button onclick="Fortune()">입력</button> -->
        <button onclick="Fortune_img()">입력</button>
        
    </h2>

    <h3>
        <div id="debug1"></div>
        <div id="debug2"></div>
        <div id="debug3"></div>
    </h3>
    
    <table class="source">
        <thead>
            <tr>
                <th id="LIST0">時</th><th id="LIST1">日</th><th id="LIST2">月</th><th id="LIST3">年</th>
            </tr>
        </thead>
        
        <tbody>
            <tr>
                <td id="time_sky"><img id="SKY0" src=""/></td><td id="day_sky"><img id="SKY1" src=""/></td><td id="month_sky"><img id="SKY2" src=""/></td><td id="year_sky"><img id="SKY3" src=""/></td>
            </tr>
            <tr>
                <td id="time_land"><img id="LAND0" src=""/></td><td id="day_land"><img id="LAND1" src=""/></td><td id="month_land"><img id="LAND2" src=""/></td><td id="year_land"><img id="LAND3" src=""/></td>
            </tr>
        </tbody>
    </table>

    <table class="variety">
        <thead></thead>
        <tbody>
            <tr>
                <td id="sky012"><img id="012i" src=""/></td><td id="sky011"><img id="011i" src=""/></td><td id="sky010"><img id="010i" src=""/></td><td id="sky009"><img id="009i" src=""/></td>
                <td id="sky008"><img id="008i" src=""/></td><td id="sky007"><img id="007i" src=""/></td><td id="sky006"><img id="006i" src=""/></td><td id="sky005"><img id="005i" src=""/></td>
                <td id="sky004"><img id="004i" src=""/></td><td id="sky003"><img id="003i" src=""/></td><td id="sky002"><img id="002i" src=""/></td><td id="sky001"><img id="001i" src=""/></td>
            </tr>
            <tr>
                <td id="land012"><img id="012p" src=""/></td><td id="land011"><img id="011p" src=""/></td><td id="land010"><img id="010p" src=""/></td><td id="land009"><img id="009p" src=""/></td>
                <td id="land008"><img id="008p" src=""/></td><td id="land007"><img id="007p" src=""/></td><td id="land006"><img id="006p" src=""/></td><td id="land005"><img id="005p" src=""/></td>
                <td id="land004"><img id="004p" src=""/></td><td id="land003"><img id="003p" src=""/></td><td id="land002"><img id="002p" src=""/></td><td id="land001"><img id="001p" src=""/></td>
            </tr>
        </tbody>
    </table>

    <script>
        var msg = document.getElementById('msg').value;
        var sky_tag = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10];
        var land_tag = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12];
        var point = [5, 5, 5, 5, 5, 5, 7, 7, 7, 8, 7, 7];

        function i_img(x){
            var num = x;
            var src = "images/" + "i" + num + ".gif";
            return src;
        }

        function p_img(x){
            var num = x;
            var src = "images/" + "p" + num + ".gif";
            return src;
        }

        function Fortune_img(){
            document.getElementById('sky001').style.background = '#FFFFFF';
            document.getElementById('sky002').style.background = '#FFFFFF';
            document.getElementById('sky003').style.background = '#FFFFFF';
            document.getElementById('sky004').style.background = '#FFFFFF';
            document.getElementById('sky005').style.background = '#FFFFFF';
            document.getElementById('sky006').style.background = '#FFFFFF';
            document.getElementById('sky007').style.background = '#FFFFFF';
            document.getElementById('sky008').style.background = '#FFFFFF';
            document.getElementById('sky009').style.background = '#FFFFFF';
            document.getElementById('sky010').style.background = '#FFFFFF';
            document.getElementById('sky011').style.background = '#FFFFFF';
            document.getElementById('sky012').style.background = '#FFFFFF';


            document.getElementById('land001').style.background = '#FFFFFF';
            document.getElementById('land002').style.background = '#FFFFFF';
            document.getElementById('land003').style.background = '#FFFFFF';
            document.getElementById('land004').style.background = '#FFFFFF';
            document.getElementById('land005').style.background = '#FFFFFF';
            document.getElementById('land006').style.background = '#FFFFFF';
            document.getElementById('land007').style.background = '#FFFFFF';
            document.getElementById('land008').style.background = '#FFFFFF';
            document.getElementById('land009').style.background = '#FFFFFF';
            document.getElementById('land010').style.background = '#FFFFFF';
            document.getElementById('land011').style.background = '#FFFFFF';
            document.getElementById('land012').style.background = '#FFFFFF';

            let today = new Date();
            var nowYear = today.getFullYear();
            var temp = document.getElementById("msg").value;
            var sexVar = document.querySelector('input[name="sex"]').checked;
            

            var yyyy = temp[0] + temp[1] + temp[2] + temp[3];
            var mm = temp[5] + temp[6];
            var dd = temp[8]+temp[9];
            var hh = temp[11] + temp[12];
            var min = temp[14] + temp[15];
            
            var a = zy(yyyy, mm)[0];
            var b = zy(yyyy, mm)[1];
            var c = zm(yyyy, mm, dd)[0];
            var d = zm(yyyy, mm, dd)[1];
            var e = zd(yyyy, mm, dd, hh, min)[0];
            var f = zd(yyyy, mm, dd, hh, min)[1];
            var g = zt(e, hh, min)[0];
            var h = zt(e, hh, min)[1];

            var seasons = great_luck(sexVar, a, c, d);
            var num = when_num(sexVar, b, d, mm, dd); 
            var startNum = Starting(num, yyyy, nowYear);
            

            /****************************************************debugging***************************************************************/
            //document.getElementById("debug1").innerHTML =Number(yyyy) + num -1;
            

            /****************************************************debugging***************************************************************/

            //window.onload = change_Color(startNum);

            document.getElementById("SKY0").src = i_img(sky_tag[g]);
            document.getElementById("SKY1").src = i_img(sky_tag[e]);
            document.getElementById("SKY2").src = i_img(sky_tag[c]);
            document.getElementById("SKY3").src = i_img(sky_tag[a]);

            document.getElementById("LAND0").src = p_img(land_tag[h]);
            document.getElementById("LAND1").src = p_img(land_tag[f]);
            document.getElementById("LAND2").src = p_img(land_tag[d]);
            document.getElementById("LAND3").src = p_img(land_tag[b]);

            for(i=0; i<12; i++){
                var num = String(i + 1);
                var idTag = num.padStart(3, '0') + "i"; 
                document.getElementById(idTag).src = i_img(sky_tag[seasons[i][0]]);
            }
            
            for(i=0; i<12; i++){
                var num = String(i + 1);
                var idTag = num.padStart(3, '0') + "p"; 
                document.getElementById(idTag).src = p_img(land_tag[seasons[i][1]]);
            }

            var tag = String(startNum);
            var skyTag = 'sky' + tag.padStart(3, '0');
            var landTag = 'land' + tag.padStart(3, '0');
            document.getElementById(skyTag).style.background = '#EFEFEF';
            document.getElementById(landTag).style.background = '#EFEFEF';

        }

        // function change_Color(startNum) {
        //     var tag = String(startNum);
        //     var skyTag = 'sky' + tag.padStart(3, '0');
        //     var landTag = 'land' + tag.padStart(3, '0');
        //     document.getElementById(skyTag).style.background = '#EFEFEF';
        //     document.getElementById(landTag).style.background = '#EFEFEF';
        // }
        

        function zy(year, month){
            var y = year;
            var m = month;
            var zodiac= (y-3)%60;
	        var pointYear = 21 * parseInt(y/4)  + 55;
            if (y%4 !== 0){
                pointYear =+ 5 * (y%4) + 1;
            }
	        
	        var deltaMonth = parseInt(m);
	        var cycleYear=zodiac; 
            if (deltaMonth < 3){
                cycleYear -= 1;
            }
            var temp = cycleYear;
            if(temp == 0){
                temp = 60;
            }
            result = [((temp-1) % 10), ((temp-1) % 12)];
            return result;
        }

        function zm(year, month, day){

            var y = year;
            var m = month;
            var d = day;
            var deltaMonth = parseInt(m);
            var zodiac= (y-3)%60;
            if(d >= point[m-1]){
                deltaMonth += 1;
            }
            var temp = 12*((zodiac-1) % 5) + deltaMonth;
            if(temp == 0){
                temp = 60;
            }        
            result = [((temp-1) % 10), ((temp-1) % 12)]
            return result;
        }

        function zd(y, m, d, h, s){
            zodiac= (y-3)%60;
            pointYear= 21 * parseInt((y%80)/4) + 55;
            if ((y % 80) % 4 !== 0){
                pointYear = pointYear + 5 * (y % 4) + 1;
            }

            var endDays = 0;
            var end = [0, 31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30];
	        if (y%4 === 0){
                end = [0, 31, 29, 31, 30, 31, 30, 31, 31, 30, 31, 30];
            }

            for (var i = 0; i < m; i++){
                endDays = endDays + end[i];
            }
            
            t = 0;
            if(h == 23){
                if (s >= 33){
                    t = 1;
                }
            }

            var cycleDay = pointYear + endDays + parseInt(d) + t - 1;
            var temp = cycleDay % 60;
            if(temp == 0){
                temp = 60;
            }
            result = [((temp-1) % 10), ((temp-1) % 12)];
            return result;
        }

        function zt(cday, hour, minute){

            var h = hour; 
            if (hour%2!==0){
                if(minute < 33){ 
                    h = h-1;
                }
                else{
                    if (h==23){
                    h = 0;
                    }
                }
            }
            var temp = 12*(cday % 5)+ parseInt(h/2) + 1;
            if(temp == 0){
                temp = 60;
            }
            var result = [((temp-1) % 10), ((temp-1) % 12)]
            return result;
        }

        function great_luck(check_sex, x, sky, land){
            var check_year = x;
            var month = 12*(5-(((10+((land+1)-(sky+1)))%10)/2)) + land+1;
            month =month%60;
            var result = [];
            if(check_sex == check_year%2){
                for(i = 1; i<=12; i++){
                    var newSky = (sky-i)%10;
                    var newLand = (land-i)%12;
                    if (newSky < 0){
                        newSky = newSky + 10;
                    }
                    if (newLand < 0){
                        newLand = newLand + 12;
                    }
                    var unit = [newSky, newLand];
                    result.push(unit);
                }
            }
            else{

                for(i = 1; i<=12; i++){
                    var newSky = (sky+i)%10;
                    var newLand = (land+i)%12;
                    if (newSky < 0){
                        newSky = newSky + 10;
                    }
                    if (newLand < 0){
                        newLand = newLand + 12;
                    }
                    var unit = [newSky, newLand];
                    result.push(unit);
                }

                
            }
            return result;
        }

        function when_num(check_sex, z_year, z_month, month, day){
            var result = 0;
            var span = 0;
            if(check_sex == z_year%2){
                result = "역행"
                span = day - point[z_month];
            }
            else{
                result = "순행"
                span = point[Number(month)] - Number(day);
            }

            var length = [31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30];
            if((z_year+1)%4 == 0){
                length = [31, 29, 31, 30, 31, 30, 31, 31, 30, 31, 30];
            }

            if(span < 0){
                span = span+length[Number(month)];
            }

            if(span > 4){
                result = span/3;
                if(span%3 == 2) result = result + 1;
            }
            else{
                result = span;
            }
           
            return result;
        }

        function Starting(s, year, nYear){
            var result = 0;
            var y = Number(year);
            var start = y + (s-1);
            var sp = nYear - start;
            result = Math.floor(sp/10)+1;

            return result;
        }

    </script>

    <!-- <table>
        <thead>
            <tr>
                <th id="LIST0">時</th><th id="LIST1">日</th><th id="LIST2">月</th><th id="LIST3">年</th>
            </tr>
        </thead>
        
        <tbody>
            <tr>
                <td id="SKY0"></td><td id="SKY1"></td><td id="SKY2"></td><td id="SKY3"></td>
            </tr>
            <tr>
                <td id="LAND0"></td><td id="LAND1"></td><td id="LAND2"></td><td id="LAND3"></td>
            </tr>
        </tbody>
    </table> -->

    <!-- <script>
        
        var msg = document.getElementById('msg').value;
        var sky = ['甲', '乙', '丙', '丁', '戊', '己', '庚', '辛', '壬', '癸']
        var land = ['子', '丑', '寅', '卯', '辰', '巳', '午', '未', '申', '酉', '戌', '亥']
        var point = [5, 5, 5, 5, 5, 5, 7, 7, 7, 8, 7, 7]
        
        
        function Fortune(){
            var temp = document.getElementById("msg").value;
            var yyyy = temp[0] + temp[1] + temp[2] + temp[3];
            var mm = temp[5] + temp[6];
            var dd = temp[8]+temp[9];
            var hh = temp[11] + temp[12];
            var min = temp[14] + temp[15];
            
            var a = zy(yyyy, mm)[0];
            var b = zy(yyyy, mm)[1];
            var c = zm(yyyy, mm, dd)[0];
            var d = zm(yyyy, mm, dd)[1];
            var e = zd(yyyy, mm, dd, hh, min)[0];
            var f = zd(yyyy, mm, dd, hh, min)[1];
            var g = zt(e, hh, min)[0];
            var h = zt(e, hh, min)[1];


            var skyline = [sky[g], sky[e], sky[c], sky[a]];
            var landline = [land[h], land[f], land[d], land[b]];

            document.getElementById("SKY0").innerHTML = skyline[0];
            document.getElementById("SKY1").innerHTML = skyline[1];
            document.getElementById("SKY2").innerHTML = skyline[2];
            document.getElementById("SKY3").innerHTML = skyline[3];
            document.getElementById("LAND0").innerHTML = landline[0];
            document.getElementById("LAND1").innerHTML = landline[1];
            document.getElementById("LAND2").innerHTML = landline[2];
            document.getElementById("LAND3").innerHTML = landline[3];

            document.getElementById("SKY0").style.color = skycolor(g);
            document.getElementById("SKY1").style.color = skycolor(e);
            document.getElementById("SKY2").style.color = skycolor(c);
            document.getElementById("SKY3").style.color = skycolor(a);

            document.getElementById("LAND0").style.color = landcolor(h);
            document.getElementById("LAND1").style.color = landcolor(f);
            document.getElementById("LAND2").style.color = landcolor(d);
            document.getElementById("LAND3").style.color = landcolor(b);
        }

        function skycolor(x){
            var result = '';
            var code = ['#008000', '#008000', '#B22222', '#B22222', '#ff8800', '#ff8800', '#696969', '#696969', '#0022ff', '#0022ff']
            var result = code[x];

            return result
        }

        function landcolor(x){
            var result = '';
            var code = ['#0022ff', '#ff8800', '#008000', '#008000', '#ff8800', '#B22222', '#B22222', '#ff8800', '#696969', '#696969', '#ff8800', '#0022ff']
            var result = code[x];
            
            return result;
        }

        function zy(year, month){
            var y = year;
            var m = month;
            var zodiac= (y-3)%60;
	        var pointYear = 21 * parseInt(y/4)  + 55;
            if (y%4 !== 0){
                pointYear =+ 5 * (y%4) + 1;
            }
	        
	        var deltaMonth = parseInt(m);
	        var cycleYear=zodiac; 
            if (deltaMonth < 3){
                cycleYear -= 1;
            }
            var temp = cycleYear;
            result = [((temp-1) % 10), ((temp-1) % 12)]
            return result;
        }

        function zm(year, month, day){

            var y = year;
            var m = month;
            var d = day;
            var deltaMonth = parseInt(m);
            var zodiac= (y-3)%60;
            if(d >= point[m-1]){
                deltaMonth += 1;
            }
            var temp = 12*((zodiac-1) % 5) + deltaMonth;        
            result = [((temp-1) % 10), ((temp-1) % 12)]
            return result;
        }

        function zd(y, m, d, h, s){
            zodiac= (y-3)%60;
            pointYear= 21 * parseInt((y%80)/4) + 55;
            if ((y % 80) % 4 !== 0){
                pointYear = pointYear + 5 * (y % 4) + 1;
            }

            var endDays = 0;
            var end = [0, 31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30];
	        if (y%4 === 0){
                end = [0, 31, 29, 31, 30, 31, 30, 31, 31, 30, 31, 30];
            }

            for (var i = 0; i < m; i++){
                endDays = endDays + end[i];
            }
            
            t = 0;
            if(h == 23){
                if (s >= 33){
                    t = 1;
                }
            }

            var cycleDay = pointYear + endDays + parseInt(d) + t - 1
            var temp = cycleDay % 60;
            result = [((temp-1) % 10), ((temp-1) % 12)];
            return result;
        }

        function zt(cday, hour, minute){

            var h = hour; 
            if (hour%2!==0){
                if(minute < 33){ 
                    h = h-1;
                }
                else{
                    if (h==23){
                    h = 0;
                    }
                }
            }
            var temp = 12*(cday % 5)+ parseInt(h/2) + 1;
            var result = [((temp-1) % 10), ((temp-1) % 12)]
            return result;
        }

        
    </script> -->
    
</body>
</html>
